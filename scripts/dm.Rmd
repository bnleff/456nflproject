---
title: "dm.Rmd"
author: "Brandon Leff"
date: "3/4/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Section to Load in Data

```{r}
#nfl <- read.csv("~/MATH456/nflplaybyplay.csv")
nfl <- read.csv("/Users/brandonleff/Desktop/math456/nflplaybyplay.csv")
#nfl <- read.csv("/home/taudin/MiscFiles/Spring20/MATH456/NFLData/nflplaybyplay.csv")
```

```{r}
library(dplyr)
```

```{r var-names-lower}
names(nfl) <- tolower(names(nfl))
```

```{r manual-var-select}
play_predict <- nfl %>% select(date,gameid,drive,qtr,down,timesecs,sideoffield,yrdln,ydstogo,firstdown,posteam,defensiveteam,yards.gained,touchdown,playtype,passattempt,passoutcome,passlength,airyards,yardsaftercatch,qbhit,passlocation,interceptionthrown,rushattempt,runlocation,rungap,fumble,sack,posteamscore,defteamscore,hometeam,awayteam,scorediff,no_score_prob,touchdown_prob)
```

# Adding Day of the week Variable

```{r day-of-week}
play_predict$day <- weekdays(as.Date(play_predict$date))
```

# Changing team labels for rams and jaguars

```{r jaguars-rams}
levels(play_predict$posteam)[levels(play_predict$posteam) == "STL"] <- "LA"
levels(play_predict$posteam)[levels(play_predict$posteam) == "JAC"] <- "JAX"
levels(play_predict$defensiveteam)[levels(play_predict$defensiveteam) == "STL"] <- "LA"
levels(play_predict$defensiveteam)[levels(play_predict$defensiveteam) == "JAC"] <- "JAX"
levels(play_predict$hometeam)[levels(play_predict$hometeam) == "STL"] <- "LA"
levels(play_predict$hometeam)[levels(play_predict$hometeam) == "JAC"] <- "JAX"
levels(play_predict$awayteam)[levels(play_predict$awayteam) == "STL"] <- "LA"
levels(play_predict$awayteam)[levels(play_predict$awayteam) == "JAC"] <- "JAX"
levels(play_predict$sideoffield)[levels(play_predict$sideoffield) == "STL"] <- "LA"
levels(play_predict$sideoffield)[levels(play_predict$sideoffield) == "JAC"] <- "JAX"
```

# Make the dataset plays where only a pass, run, sack, spike, punt happened

```{r only-pass-run-sack-spike-punt}
dope_plays <- c("Pass", "Run","Punt")
play_predict <- play_predict %>% filter(playtype %in% dope_plays)
play_predict$playtype <- droplevels(play_predict$playtype)
```

```{r drop-levels-50-yard-line}
play_predict$sideoffield <- droplevels(play_predict$sideoffield)
```

```{r}
play_predict$timesecs <- 3600 - play_predict$timesecs
```

# dropping date

```{r}
play_predict <- play_predict %>% select(-c(date))
```

# dropping blank level of posteam

```{r}
play_predict <- play_predict %>% filter(posteam != "")
play_predict$posteam <- droplevels(play_predict$posteam)
```

## Create a Clean Dataset (Everyone)

```{r}
saveRDS(play_predict, file="~/final_nfl.rds")
```

